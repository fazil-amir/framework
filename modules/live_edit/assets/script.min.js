LiveEdit=function(){this.$editKey=$("[data-live-edit-id]"),this.$startBtn,this.$saveBtn,this.$wrapper,this.$resetBtn;var t=this;this.init=function(){this.renderElements(),this.startEditing()},this.setSuccessMessage=function(){var t=$("<div />",{class:"message-wrapper",html:"Page data saved"}).appendTo(this.$wrapper);setTimeout(function(){t.remove()},4e3)},this.startEditing=function(){console.log("Editing started"),this.$editKey.attr("contenteditable",!0),this.$editKey.off("click"),this.$editKey.on("click",function(t){t.preventDefault()}),this.$editKey.on("keydown",function(t){if(t.target.setAttribute("touched",!0),13===t.keyCode)return document.execCommand("insertHTML",!1,"<br><br>"),!1}),this.$startBtn.hide(),this.$saveBtn.show(),this.$resetBtn.show()},this.saveEditing=function(){this.$saveBtn.attr("disabled","disabled"),console.log("Saving data");var e=new FormData;e.append("page-name",$("main").data("page-name"));var i=[];this.$editKey.each(function(){$(this).attr("touched")&&i.push({[$(this).data("live-edit-id")]:$(this).html()})}),e.append("data",JSON.stringify(i)),$.ajax({method:"POST",url:baseURL("panel/live-edit/client/save"),data:e,cache:!1,contentType:!1,processData:!1,dataType:"json"}).done(function(){t.$editKey.removeAttr("contenteditable"),t.$editKey.off("click"),t.$startBtn.show(),t.$saveBtn.hide(),t.$resetBtn.hide(),t.$saveBtn.removeAttr("disabled"),t.setSuccessMessage()})},this.renderElements=function(){var e=$("<button />",{html:"Start Editing",class:"button start"}).on("click",function(){t.startEditing()}),i=$("<button />",{html:"Save Editing",class:"button save"}).on("click",function(){t.saveEditing()}),s=$("<button />",{html:"Reset",class:"button reset"}).on("click",function(){t.resetEditing()}),n=$("<div />",{class:"live-edit-wrapper"}).append($("<div />",{class:"button-wrapper"}).append(e,i,s));$("body").append(n).css({paddingBottom:n.outerHeight()}),this.$startBtn=e,this.$saveBtn=i,this.$wrapper=n,this.$resetBtn=s},this.resetEditing=function(){window.location=window.location.href,this.$startBtn.show(),this.$saveBtn.hide(),this.$resetBtn.hide()},this.init()},new LiveEdit;