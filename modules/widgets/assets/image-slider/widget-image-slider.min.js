"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _createClass=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}();$("document").ready(function(){var e=$("[data-page-name]").data("page-name");switch($("select.form-control").selectpicker(),e){case"WIDGET_IMAGE_SLIDER_ADD_VIEW":var t=new ImageSlider;$("#submit-widget").on("click",function(){form.init($(this).data("form"),{buttonSelector:"#submit-widget",buttonText:"Please Wait..."},function(e){1===e.success?showMessage(e.message,"default"):showMessage(e.message,"error")}),form.validate()&&t.submit()})}});var ImageSlider=function(e){function t(){_classCallCheck(this,t);var c=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return c.preloadSlides=function(){c.getRichDataParsed().then(function(e){e?e.map(function(e){c.renderSlide(e)}):c.renderSlide()})},c.handleAddSlideClick=function(){c.addSlideBtn.addEventListener("click",function(){return c.renderSlide()})},c.initSliderImage=function(e){(new ModernFileInput).init($("#"+e),!0,!0)},c.findAndReplace=function(e,t,n){var i="{{"+t+"}}";return e.replace(i,n).replace(i,n)},c.renderSlide=function(){var s=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;c.fetchTemplate().then(function(e){var t="slider-slide-image-"+c.slideCounter,n="slider-delete-"+c.slideCounter,i="slider-collapse-"+c.slideCounter;e=c.findAndReplace(e,"SLIDE_COUNT",c.slideCounter),e=c.findAndReplace(e,"SLIDER_IMG_ID",t),e=c.findAndReplace(e,"SLIDE_DELETE_ID",n),e=c.findAndReplace(e,"SLIDE_COLLAPSE_ID",i),e=c.findAndReplace(e,"SAME_PAGE_RADIO_ID","target-radio-same-"+c.slideCounter),e=c.findAndReplace(e,"NEW_PAGE_RADIO_ID","target-radio-new-"+c.slideCounter),e=c.findAndReplace(e,"TARGET_RADIO","target-radio-"+c.slideCounter);var l=s&&s.headline?s.headline:"";e=c.findAndReplace(e,"SLIDER_HEADLINE",l);var a=s&&s.caption?s.caption:"";e=c.findAndReplace(e,"SLIDER_CAPTION",a);var r=s&&s.btn_link?s.btn_link:"";e=c.findAndReplace(e,"SLIDER_BTN_LINK",r);var d=s&&s.btn_caption?s.btn_caption:"";e=c.findAndReplace(e,"SLIDER_BTN_CAPTION",d),"new"===(s&&s.target?s.target:"")?(e=c.findAndReplace(e,"SLIDER_TARGET_SAME_PAGE",""),e=c.findAndReplace(e,"SLIDER_TARGET_NEW_PAGE",'checked="checked"')):(e=c.findAndReplace(e,"SLIDER_TARGET_SAME_PAGE",'checked="checked"'),e=c.findAndReplace(e,"SLIDER_TARGET_NEW_PAGE",""));var o=s&&s.slide_image?s.slide_image:"";e=c.findAndReplace(e,"SLIDER_IMAGE",c.getImageTemplate(o)),c.sliderContainer.insertAdjacentHTML("beforeend",e),c.initSliderImage(t),c.handleSlideDelete(n),c.handleSlideCollapse(i,s),c.slideCounter++})},c.fetchTemplate=function(){return fetch(c.templateLocation,{headers:{"Cache-Control":"no-cache"}}).then(function(e){return e.text()}).then(function(e){return Promise.resolve(e)})},c.handleSlideDelete=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";document.getElementById(e)&&document.getElementById(e).addEventListener("click",function(t){popup.confirm({content:"Are you sure?",backdrop_close:!1},function(e){e.proceed&&t.target.parentNode.remove()})})},c.initSortable=function(){$("#slider-slides").sortable({handle:"span.move-handle",axis:"y"})},c.getImageTemplate=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";return e?'<div class="preview-images cover-image"><img src="'+e+'"><span class="icon delete"></span></div>':""},c.getSliderData=function(){for(var e=[],t=0;t<c.slideElements.length;t++){var n=c.slideElements[t].getElementsByTagName("input"),i=c.slideElements[t].querySelector(".preview-images img");e.push({headline:n[0].value,caption:n[1].value,btn_link:n[2].value,btn_caption:n[3].value,target:n[4].checked?n[4].value:n[5].value,slide_image:i.getAttribute("src")})}return e},c.submit=function(){c.saveWidget(c.getSliderData())},c.slideCounter=1,c.templateLocation=baseURL("modules/widgets/assets/image-slider/widget-image-slider-tmpl.html"),c.sliderContainer=document.getElementById("slider-slides"),c.slideElements=document.getElementsByClassName("slide"),c.addSlideBtn=document.getElementById("add-slide-btn"),c.collapseHandle=document.getElementsByClassName("collapse-handle"),c.preloadSlides(),c.handleAddSlideClick(),c.initSortable(),c.collapseOnlyLast(),c}return _inherits(t,Widget),_createClass(t,[{key:"handleSlideCollapse",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",n=1<arguments.length&&void 0!==arguments[1]&&arguments[1];setTimeout(function(){var e=document.getElementById(t);e&&(n&&e.parentNode.classList.add("toggle-collapse"),e.addEventListener("click",function(e){e.target.parentNode.classList.toggle("toggle-collapse")}))},100)}},{key:"collapseOnlyLast",value:function(){var n=this;setTimeout(function(){for(var e=0;e<n.slideElements.length;e++){var t=n.slideElements[e];e!==n.slideElements.length-1&&t.classList.toggle("toggle-collapse")}},100)}}]),t}();
//# sourceMappingURL=widget-image-slider.min.js.map