"use strict";function _defineProperty(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}$("document").ready(function(){switch($("[data-page-name]").data("page-name")){case"BLOCK_CMS_CATEGORIES":case"BLOCK_CMS_POSTS":$(".form-records").tablesorter(),new DeleteEntry(".cms-delete-trigger"),new PushToggle(".cms-featured"),new PushToggle(".cms-visibility"),(new MakePagination).staticPagination($(".form-records"),10),(new MakeEditable).init($(".cms-edit-trigger"));break;case"BLOCK_CMS_ADD_POST_VIEW":$("select.form-control").selectpicker(),(new ModernFileInput).init($("#image-gallery-input"));var t=new BlockCMS;t.initBannerImage(),t.initAddBlocks(),t.initSortable(),t.initCollapse(),t.initRemoveBlock(),t.initSubmitPost(),t.initDefaultText();break;case"BLOCK_CMS_ADD_CATEGORY_VIEW":$("select.form-control").selectpicker(),(new ModernFileInput).init($("#banner-image"),!0,!0),$("#submit-category").on("click",function(){form.init($(this).data("form"),{buttonSelector:"#submit-category",buttonText:"Please Wait..."},function(t){1===t.success?("INSERT"==t.operation&&$($("#submit-category").data("form")).attr("action",baseURL("panel/block-cms/category/add-update/"+t.data.catID)),showMessage(t.message,"default")):showMessage(t.message,"error")}),form.validate(),form.submit()})}});var BlockCMS=function(){this.$container=$("#page-data-container"),this.CM_Instances=[];var r=this;this.initDefaultText=function(){var t=$("[data-source]").data("source");if(!t)return!1;$.ajax({cache:!1,url:t,dataType:"json",success:function(t){t.forEach(function(t,e){switch(Object.keys(t)[0]){case"PAGE_BANNER":r.setPageHeaderData(t.PAGE_BANNER);break;case"TEXT":var a=[];t.TEXT.forEach(function(t){a.push(Object.entries(t)[0][0].split("-")[2])}),r.addTextBlock(a.join(","),t.TEXT);break;case"USER_HTML":r.addUserHTML(t.USER_HTML)}})}})},this.initBannerImage=function(){(new ModernFileInput).custom($("#intro-banner-image"),function(t){t.success?$("#blog-intro-banner").attr("src",t.message):showMessage(t.message.message,"error")})},this.initAddBlocks=function(){$(".add-blog-item").on("click",function(){switch($(this).data("block-type")){case"JUMBOTRON":r.addJumbotron();break;case"HIGHLIGHTER":r.addHighlighter();break;case"TEXT":r.addTextBlock($(this).data("block-size"));break;case"USER_HTML":r.addUserHTML()}})},this.initSortable=function(){$(function(){$("#page-data-container").sortable({handle:".move-handle",axis:"y"})})},this.initRemoveBlock=function(){$("body").on("click",".remove",function(){var e=this;popup.confirm({content:"Confirm Delete?",backdrop_close:!1},function(t){t.proceed&&$(e).parents(".block-container").remove()})})},this.initSubmitPost=function(){$("#submit-post").on("click",function(t){window.toggleLoading();var e,a=new ProcessForm,n=[],i=[];if(a.init($(this).data("form"),{buttonSelector:"#submit-post",buttonText:"Please Wait..."}),!a.validate())return!1;var o=0;$(".block-container").each(function(){var t=$(this);switch($(this).data("block-type")){case"TEXT":n.push(r.getTextData(t));break;case"PAGE_BANNER":n.push(r.getPageHeaderData(t));break;case"USER_HTML":n.push(r.getUserHTML(o++))}}),$($(this).data("form")).find('[type="file"]').each(function(){$(this).parent().parent().find("div.preview-images img").each(function(t){i.push($(this).attr("src"))})}),e={seoTitle:$("#seo-title").val(),seoURI:$("#seo-uri").val(),seoKeywords:$("#seo-keywords").val(),seoDescription:$("#seo-description").val(),pageTitle:$("#page-title").val(),pageCaption:$("#page-caption").val(),pageType:$('input[name="page-type"]:checked').val(),shortDescription:$("#shot-description").val(),pageAuthor:$("#page-author").val(),visibility:$("#visibility:checked").val()?"on":"off",featured:$("#featured:checked").val()?"on":"off",language:$("#language").val(),categories:$("#category").val()},r.doAjax({method:"POST",URL:$($(this).data("form")).attr("action"),formData:[{metaData:e,richData:n,imageGallery:i}],callback:function(t){1==t.success?showMessage(t.message,"default"):showMessage(t.message,"error"),console.log("done"),window.toggleLoading(!1)}}),t.preventDefault()})},this.initCollapse=function(){$("body").on("click",".collapse-handle",function(){$(this).parents(".block-container").toggleClass("collapse-content")})},this.doAjax=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{method:"POST",URL:"",formData:"",callback:""};$.ajax({method:e.method,data:{data:e.formData},url:e.URL,dataType:"json"}).done(function(t){e.callback&&e.callback(t)}).fail(function(t){console.error(t)})},this.addJumbotron=function(){0<arguments.length&&void 0!==arguments[0]&&arguments[0];r.$container.append('\n\t\t\t<div class="container jumbotron" data-block-type="JUMBOTRON" >\n\t\t\t\t<div class="col-sm-6">\n\t\t\t\t\t<input type="text" id="headline" />\n\t\t\t\t\t<textarea id="content"></textarea>\n\t\t\t\t</div>\n\t\t\t\t<div class="col-sm-6">\n\t\t\t\t\t<table class="form-table">\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td class="input">\n\t\t\t\t\t\t\t\t<label class="file">\n\t\t\t\t\t\t\t\t\tChange Banner\n\t\t\t\t\t\t\t\t\t<input type="file" name="intro-banner-image" class="form-control validate" id="intro-banner-image">\n\t\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</table>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t')},this.addHighlighter=function(){0<arguments.length&&void 0!==arguments[0]&&arguments[0];alert("addHighlighter")},this.addUserHTML=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",e="user-html-content-"+$(".user-html-content").length+1,a='\n\t\t\t<div class="block-container user-html" data-block-type="USER_HTML" >\n\t\t\t\t'+this.getComponentHeader()+"\n\t\t\t\t<div class='row item-wrapper-main'>\n\t\t\t\t\t<div class='col-sm-12'>\n\t\t\t\t\t\t<textarea class=\"user-html-content\" id=\""+e+'"></textarea>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\t\t\n\t\t\t</div>\n\t\t';r.$container.append(a);var n=CodeMirror.fromTextArea(document.getElementById(e),{mode:"xml",htmlMode:!0,theme:"lucario",lineNumbers:!0,matchBrackets:!0,indentUnit:2});n.setSize(null,300),r.CM_Instances.push(n),t&&n.setValue(t),setTimeout(function(){n.refresh()},1e3)},this.addTextBlock=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",a="";if(12==t){if(a+='\n\t\t\t\t<div class="col-md-12" data-col-size="col-md-12" >\n\t\t\t\t\t<textarea id="'+(o=r.getID())+'" class="rich-text-editor" />\n\t\t\t\t</div>\n\t\t\t',r.bindSummernote(o),e){var n=Object.keys(e[0]);r.bindSummernoteContent(o,e[0][n])}}else{t=t.split(",");for(var i=0;i<t.length;i++){var o=r.getID()+"_"+i;if(a+='\n\t\t\t\t\t<div class="'+r.getBootstrapCols(t[i])+'" data-col-size="'+r.getBootstrapCols(t[i])+'">\n\t\t\t\t\t\t<textarea id="'+o+'" class="rich-text-editor" />\n\t\t\t\t\t</div>\n\t\t\t\t',r.bindSummernote(o),e){n=Object.keys(e[i]);r.bindSummernoteContent(o,e[i][n])}}}var s='\n\t\t\t<div class="block-container text-block" data-block-type="TEXT" >\n\t\t\t\t'+this.getComponentHeader()+'\n\t\t\t\t<div class="row item-wrapper-main">'+a+"</div>\n\t\t\t</div>\n\t\t";r.$container.append(s)},this.getTextData=function(t){for(var e=[],a=(t=t.find("[data-col-size]"),0);a<t.length;a++)e.push(_defineProperty({},t.eq(a).attr("class"),t.eq(a).find(".rich-text-editor").summernote("code")));return{TEXT:e}},this.getUserHTML=function(t){return{USER_HTML:r.CM_Instances[t].getValue()}},this.getPageHeaderData=function(t){return{PAGE_BANNER:{headline:t.find("#blog-intro-text").val(),subHeadline:t.find("#blog-sub-text").val(),background:t.find("#blog-intro-banner").attr("src")}}},this.setPageHeaderData=function(t){$("#blog-intro-text").val(t.headline),$("#blog-sub-text").val(t.subHeadline),$("#blog-intro-banner").attr("src",t.background)},this.bindSummernote=function(n){setTimeout(function(){$("#"+n).summernote({toolbar:[["style",["format","bold","clear"]],["style",["style","formatH2"]],["para",["ul","ol","paragraph"]],["insert",["video","picture","table"]]],height:"auto",theme:"yati",callbacks:{onImageUpload:function(t){var e=new FormData,a=$("#"+n).parents("form").attr("action").split("/").pop().toLowerCase().replace(" ","");e.append("image",t[0]),e.append("directory","uploads/cms/posts/"+a+"/images"),$.ajax({data:e,type:"POST",dataType:"json",url:baseURL("panel/operations/upload-image"),cache:!1,contentType:!1,processData:!1,success:function(t){$("#"+n).summernote("insertImage",t.url)},error:function(t){console.log(t)}})}}}),$(".note-editor .dropdown-menu li").each(function(){"pre"!=$(this).find("a").data("value")&&"h1"!=$(this).find("a").data("value")&&"h4"!=$(this).find("a").data("value")&&"h4"!=$(this).find("a").data("value")&&"h5"!=$(this).find("a").data("value")&&"h6"!=$(this).find("a").data("value")||$(this).remove(),"h2"==$(this).find("a").data("value")&&$(this).find("a").html("<p>Heading 1<p>"),"h3"==$(this).find("a").data("value")&&$(this).find("a").html("<p>Heading 2<p>"),"p"==$(this).find("a").data("value")&&$(this).find("a").html("<p>Paragraph</p>"),"blockquote"==$(this).find("a").data("value")&&$(this).find("a").html("<p>Blockquote</p>")})},0)},this.bindSummernoteContent=function(t,e){setTimeout(function(){$("#"+t).summernote("code",e)},1)},this.getBootstrapCols=function(t){switch(t){case"12":return"col-sm-12";case"11":return"col-sm-11";case"10":return"col-sm-10";case"9":return"col-sm-9";case"8":return"col-sm-8";case"7":return"col-sm-7";case"6":return"col-sm-6";case"5":return"col-sm-5";case"4":return"col-sm-4";case"3":return"col-sm-3";case"2":return"col-sm-2";case"1":return"col-sm-1"}},this.getID=function(){var e="rich-block-count-0";return $("textarea").each(function(t){e="rich-block-count-"+t}),e},this.getComponentHeader=function(){return"\n\t\t\t<div class='component-header'>\n\t\t\t\t<span class=\"move-handle icon move\"></span>\n\t\t\t\t<span class='icon arrow-double collapse-handle'></span>\n\t\t\t\t<span class=\"remove icon delete\"></span>\n\t\t\t</div>\n\t\t"},this.setErrorMsg=function(t,e){r.process=!1;var a="";switch(e.error){case"EMPTY":a="This field is required";break;case"MIN":a="Does not meet minimum character length";break;case"MAX":a="The value you entered was too big"}"SUMMERNOTE"==e.type?e.element.append('<span class="error">'+a+"</span>"):t.append('<span class="error">'+a+"</span>")},this.unsetErrorMsg=function(){this.process=!0,$(".error").remove()}};
//# sourceMappingURL=block-cms.min.js.map