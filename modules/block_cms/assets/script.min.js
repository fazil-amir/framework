$("document").ready(function(){switch($("[data-page-name]").data("page-name")){case"BLOCK_CMS_CATEGORIES":case"BLOCK_CMS_POSTS":$(".form-records").tablesorter(),new DeleteEntry(".cms-delete-trigger"),new PushToggle(".cms-featured"),new PushToggle(".cms-visibility");(new MakePagination).staticPagination($(".form-records"),10);(new MakeEditable).init($(".cms-edit-trigger"));break;case"BLOCK_CMS_ADD_POST_VIEW":$("select.form-control").selectpicker();(e=new ModernFileInput).init($("#image-gallery-input"));var t=new BlockCMS;t.initBannerImage(),t.initAddBlocks(),t.initSortable(),t.initRemoveBlock(),t.initSubmitPost(),t.initDefaultText();break;case"BLOCK_CMS_ADD_CATEGORY_VIEW":$("select.form-control").selectpicker();var e=new ModernFileInput;e.init($("#banner-image"),!0,!0),$("#submit-category").on("click",function(){form.init($(this).data("form"),{buttonSelector:"#submit-category",buttonText:"Please Wait..."},function(t){1===t.success?("INSERT"==t.operation&&$($("#submit-category").data("form")).attr("action",baseURL("panel/block-cms/category/add-update/"+t.data.catID)),showMessage(t.message,"default")):showMessage(t.message,"error")}),form.validate(),form.submit()})}});var BlockCMS=function(){this.$container=$("#page-data-container"),this.CM_Instances=[];var t=this;this.initDefaultText=function(){var e=$("[data-source]").data("source");if(!e)return!1;$.ajax({cache:!1,url:e,dataType:"json",success:function(e){e.forEach((e,a)=>{switch(Object.keys(e)[0]){case"PAGE_BANNER":t.setPageHeaderData(e.PAGE_BANNER);break;case"TEXT":var n=[];e.TEXT.forEach(t=>{n.push(Object.entries(t)[0][0].split("-")[2])}),t.addTextBlock(n.join(","),e.TEXT);break;case"USER_HTML":t.addUserHTML(e.USER_HTML)}})}})},this.initBannerImage=function(){(new ModernFileInput).custom($("#intro-banner-image"),function(t){t.success?$("#blog-intro-banner").attr("src",t.message):showMessage(t.message.message,"error")})},this.initAddBlocks=function(){$(".add-blog-item").on("click",function(){switch($(this).data("block-type")){case"JUMBOTRON":t.addJumbotron();break;case"HIGHLIGHTER":t.addHighlighter();break;case"TEXT":t.addTextBlock($(this).data("block-size"));break;case"USER_HTML":t.addUserHTML()}})},this.initSortable=function(){$(function(){$("#page-data-container").sortable({handle:".move-handle",axis:"y"})})},this.initRemoveBlock=function(){$("body").on("click",".remove",function(){$(this).parents(".block-container").remove()})},this.initSubmitPost=function(){$("#submit-post").on("click",function(e){var a=new ProcessForm,n={},s=[],i=[];if(a.init($(this).data("form"),{buttonSelector:"#submit-post",buttonText:"Please Wait..."}),!a.validate())return!1;var o=0;$(".block-container").each(function(){var e=$(this);switch($(this).data("block-type")){case"TEXT":s.push(t.getTextData(e));break;case"PAGE_BANNER":s.push(t.getPageHeaderData(e));break;case"USER_HTML":s.push(t.getUserHTML(o++))}}),$($(this).data("form")).find('[type="file"]').each(function(){$(this).parent().parent().find("div.preview-images img").each(function(t){i.push($(this).attr("src"))})}),n={seoTitle:$("#seo-title").val(),seoURI:$("#seo-uri").val(),seoKeywords:$("#seo-keywords").val(),seoDescription:$("#seo-description").val(),pageTitle:$("#page-title").val(),pageType:$('input[name="page-type"]:checked').val(),shortDescription:$("#shot-description").val(),pageAuthor:$("#page-author").val(),visibility:$("#visibility:checked").val()?"on":"off",featured:$("#featured:checked").val()?"on":"off",language:$("#language").val(),categories:$("#category").val()},t.doAjax({method:"POST",URL:$($(this).data("form")).attr("action"),formData:[{metaData:n,richData:s,imageGallery:i}],callback:t=>{1==t.success?showMessage(t.message,"default"):showMessage(t.message,"error")}}),e.preventDefault()})},this.doAjax=function(t={method:"POST",URL:"",formData:"",callback:""}){$.ajax({method:t.method,data:{data:t.formData},url:t.URL,dataType:"json"}).done(e=>{t.callback&&t.callback(e)}).fail(t=>{console.error(t)})},this.addJumbotron=function(e=""){t.$container.append('\n\t\t\t<div class="container jumbotron" data-block-type="JUMBOTRON" >\n\t\t\t\t<div class="col-sm-6">\n\t\t\t\t\t<input type="text" id="headline" />\n\t\t\t\t\t<textarea id="content"></textarea>\n\t\t\t\t</div>\n\t\t\t\t<div class="col-sm-6">\n\t\t\t\t\t<table class="form-table">\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td class="input">\n\t\t\t\t\t\t\t\t<label class="file">\n\t\t\t\t\t\t\t\t\tChange Banner\n\t\t\t\t\t\t\t\t\t<input type="file" name="intro-banner-image" class="form-control validate" id="intro-banner-image">\n\t\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</table>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t')},this.addHighlighter=function(t=""){alert("addHighlighter")},this.addUserHTML=function(e=""){var a="user-html-content-"+$(".user-html-content").length+1,n=`\n\t\t\t<div class="block-container user-html" data-block-type="USER_HTML" >\n\t\t\t\t<span class="move-handle icon move"></span>\n\t\t\t\t<span class="remove icon delete"></span>\n\t\t\t\t<textarea class="user-html-content" id="${a}"></textarea>\t\t\t\t\n\t\t\t</div>\n\t\t`;t.$container.append(n);var s=CodeMirror.fromTextArea(document.getElementById(a),{mode:"xml",htmlMode:!0,theme:"lucario",lineNumbers:!0,matchBrackets:!0,indentUnit:2});s.setSize(null,300),t.CM_Instances.push(s),e&&s.setValue(e),setTimeout(function(){s.refresh()},1e3)},this.addTextBlock=function(e,a=""){var n="";if(12==e){if(n+=`\n\t\t\t\t<div class="col-md-12" data-col-size="col-md-12" >\n\t\t\t\t\t<textarea id="${i=t.getID()}" class="rich-text-editor" />\n\t\t\t\t</div>\n\t\t\t`,t.bindSummernote(i),a){o=Object.keys(a[0]);t.bindSummernoteContent(i,a[0][o])}}else{e=e.split(",");for(var s=0;s<e.length;s++){var i=t.getID()+"_"+s;if(n+=`\n\t\t\t\t\t<div class="${t.getBootstrapCols(e[s])}" data-col-size="${t.getBootstrapCols(e[s])}">\n\t\t\t\t\t\t<textarea id="${i}" class="rich-text-editor" />\n\t\t\t\t\t</div>\n\t\t\t\t`,t.bindSummernote(i),a){var o=Object.keys(a[s]);t.bindSummernoteContent(i,a[s][o])}}}var r=`\n\t\t\t<div class="block-container text-block" data-block-type="TEXT" >\n\t\t\t\t<span class="move-handle icon move"></span>\n\t\t\t\t<span class="remove icon delete"></span>\n\t\t\t\t<div class="row">${n}</div>\n\t\t\t</div>\n\t\t`;t.$container.append(r)},this.getTextData=function(t){for(var e=[],t=t.find("[data-col-size]"),a=0;a<t.length;a++)e.push({[t.eq(a).attr("class")]:t.eq(a).find(".rich-text-editor").summernote("code")});return{TEXT:e}},this.getUserHTML=function(e){return{USER_HTML:t.CM_Instances[e].getValue()}},this.getPageHeaderData=function(t){return{PAGE_BANNER:{headline:t.find("#blog-intro-text").val(),subHeadline:t.find("#blog-sub-text").val(),background:t.find("#blog-intro-banner").attr("src")}}},this.setPageHeaderData=function(t){$("#blog-intro-text").val(t.headline),$("#blog-sub-text").val(t.subHeadline),$("#blog-intro-banner").attr("src",t.background)},this.bindSummernote=function(t){setTimeout(function(){$("#"+t).summernote({toolbar:[["style",["format","bold","italic","underline","clear"]],["style",["style","formatH2"]],["para",["ul","ol","paragraph"]],["Misc",["undo","undo"]],["insert",["video","picture","table"]]],height:"auto",callbacks:{onImageUpload:function(e){var a=new FormData,n=$("#"+t).parents("form").attr("action").split("/").pop().toLowerCase().replace(" ","");a.append("image",e[0]),a.append("directory","uploads/cms/posts/"+n+"/images"),$.ajax({data:a,type:"POST",dataType:"json",url:baseURL("panel/operations/upload-image"),cache:!1,contentType:!1,processData:!1,success:function(e){$("#"+t).summernote("insertImage",e.url)},error:function(t){console.log(t)}})}}}),$(".note-editor .dropdown-menu li").each(function(){"pre"!=$(this).find("a").data("value")&&"h1"!=$(this).find("a").data("value")&&"h4"!=$(this).find("a").data("value")&&"h4"!=$(this).find("a").data("value")&&"h5"!=$(this).find("a").data("value")&&"h6"!=$(this).find("a").data("value")||$(this).remove(),"h2"==$(this).find("a").data("value")&&$(this).find("a").html("<p>Heading 1<p>"),"h3"==$(this).find("a").data("value")&&$(this).find("a").html("<p>Heading 2<p>"),"p"==$(this).find("a").data("value")&&$(this).find("a").html("<p>Paragraph</p>"),"blockquote"==$(this).find("a").data("value")&&$(this).find("a").html("<p>Blockquote</p>")})},0)},this.bindSummernoteContent=function(t,e){setTimeout(function(){$("#"+t).summernote("code",e)},1)},this.getBootstrapCols=function(t){switch(t){case"12":return"col-sm-12";case"11":return"col-sm-11";case"10":return"col-sm-10";case"9":return"col-sm-9";case"8":return"col-sm-8";case"7":return"col-sm-7";case"6":return"col-sm-6";case"5":return"col-sm-5";case"4":return"col-sm-4";case"3":return"col-sm-3";case"2":return"col-sm-2";case"1":return"col-sm-1"}},this.getID=function(){var t="rich-block-count-0";return $("textarea").each(function(e){t="rich-block-count-"+e}),t},this.setErroMsg=function(e,a){t.process=!1;var n="";switch(a.error){case"EMPTY":n="This field is required";break;case"MIN":n="Does not meet minimum character length";break;case"MAX":n="The value you entered was too big"}"SUMMERNOTE"==a.type?a.element.append('<span class="error">'+n+"</span>"):e.append('<span class="error">'+n+"</span>")},this.unsetErrorMsg=function(){this.process=!0,$(".error").remove()}};